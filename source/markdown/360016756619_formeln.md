Mit der Anwendung von Formeln in Xentralkönnen Sie mathematische Operationen mit den verschiedensten Feldern aus Ihren Belegen durchführen. Im Folgenden erläutern wir Ihnen die grundlegenden Einstellungen zur Vorbereitung und zur Anwendung des Formelkonzeptes in Xentral.

## Vorbereitende Einstellungen zur Verwendung von Formeln in Xentral

Grundsätzlich sollten Sie sich im Vorfeld Gedanken machen, welche Felder Sie in die Formeln einbeziehen wollen.

Hier bietet Xentral eine Vielzahl von Möglichkeiten. Stellen Sie bitte sicher, dass die benötigten Bereiche entsprechend gepflegt sind. So sollte ein Freifeld mit numerischen Werten gefüllt sein, damit auch mathematische Operationen durchgeführt werden können.

InXentralkönnen Sie grundsätzlich den Preis und die Menge in den Belegen ansprechen. Wenn Sie Freifelder nutzen, bietet sich Ihnen die Möglichkeit Ihre individuellen Ansprüche abzubilden und in Berechnungen mit einzubeziehen. Allgemeine Informationen zu Freifeldern finden Sie im Artikel[Freifelder](https://help.xentral.com/hc/de/articles/360017612120#UUID-dfa23e64-d4d3-3d8b-4e17-843cc0b0dfb9).

Um Freifelder in Formeln nutzen zu können, beachten Sie bitte Folgendes:

- Grundsätzlich wird in den Freifeldern der Inhalt aus den Stammdaten gezogen, sofern diese gepflegt sind.
- Manuelle Anpassungen sind möglich, müssen dann aber in der Positionsliste des Belegs vorgenommen werden.

Damit können Sie jederzeit auf die Freifelder des Artikels zugreifen und müssen diese nicht zwingend im Beleg neu anlegen.

UnterAdministration > Einstellungen > System > Grundeinstellungen > Freifeldermüssen folgende Felder beachtet werden:

- Der Haken bei Freifelder im Artikel einblenden muss gesetzt sein.
- Anzeige im PDF: Hier können Sie bestimmen wo die Freifelder ausgegeben werden sollen.

![formeln_1.png](https://help.xentral.com/hc/article_attachments/5078144788636)

Das ist für die Berechnung relevant, weil nur die angezeigten Freifelder in die Berechnung miteinbezogen werden.

![mceclip0.png](https://help.xentral.com/hc/article_attachments/5078191692316)

Soll der Name des Freifeldes nicht angezeigt werden, so muss die Checkbox bei Positionen mit Freifelder leer bleiben (Grundeinstellungen > Einstellungen > System). Damit können Sie verhindern, dass zu viel Text in die Beschreibung aufgenommen wird. Brauchen Sie die Beschreibung dennoch, bitte den Haken setzen.

Anzeige ohne Haken in der Checkbox Positionen mit Freifelder:

![formeln_3.png](https://help.xentral.com/hc/article_attachments/5078191725980)

Anzeige mit Haken in der Checkbox Positionen mit Freifelder:

![formeln_4.png](https://help.xentral.com/hc/article_attachments/5078138942876)

## Arbeitsweise mit Formeln

### Formeln in den Belegen

Sie haben die Möglichkeit eine Formel im Editor zu erstellen und dann als Kürzel zu verwenden. Das dient der Übersichtlichkeit und erlaubt Ihnen die Formeln zentral zu verwalten. Allerdings können Sie die Berechnungen auch direkt in der Artikelbeschreibung durchführen. Grundsätzlich sind die Freifelder, Menge und Preis ansprechbar.

Im App Center finden Sie die App Formeln. Hier können Sie für verschiedene Zwecke Formeln definieren, die Sie über die dazugehörige ID im folgenden als Variable in Xentral nutzen können: {FORMELID} z.B {FORMEL1}

![formeln_5.png](https://help.xentral.com/hc/article_attachments/5078138964124)

Nachdem man eine Kennung und einen Namen für die Formel vergeben hat, kann man die Formel über dasStift-Iconhinterlegen.

![formeln_6.png](https://help.xentral.com/hc/article_attachments/5078176824860)

Interpretation: In diesem Beispiel soll der eingetragene Wert des Artikels aus Freifeld 1 mit der Menge der Position1 aus dem Beleg multipliziert und letztlich durch 1000 geteilt werden, um die Zieleinheit (kW) auszugeben. Hier können die üblichen Rechenoperatoren "*", " / ", " + " und "-" als auch "sin" und "cos" genutzt werden. Bei verschachtelten Formeln ist die Verwendung von Klammern "()" gemäß den mathematischen Rechengesetzen zu beachten.

Die Formel kann dann wie folgt im Angebot, zum Beispiel im Artikelfreitext, hinterlegt und entsprechend ausgegeben werden.

![formeln_7.png](https://help.xentral.com/hc/article_attachments/5078124688412)

Dabei wird der Wert dann wie folgt auf dem Beleg, hier im Angebot, ausgegeben.

![formeln_8.png](https://help.xentral.com/hc/article_attachments/5078155403164)

Eine Verwendung in den Textvorlagen unter Administration >Einstellungen >System >Grundeinstellungen >System im Reiter Textvorlagen kann analog erfolgen.

Um in der Positionsansicht der Belege auch auf Mengen und Preise der anderen Positionen zugreifen zu können, ist es nun unter Stammdaten &gt; Artikel in den Details möglich, Formeln auf Preise und Mengen (weiterhin auch Freifelder) zu beziehen:

![formeln_10.png](https://help.xentral.com/hc/article_attachments/5078124769180)

In dem folgenden Beispiel wurde der Artikel als dritte Angebotsposition hinzugefügt und die obenstehende Berechnung für die Menge und den Preis der Position durchgeführt.

![formeln_11.png](https://help.xentral.com/hc/article_attachments/5078139162140)

Interpretation: Menge der Position1 = 15* Preis der Position1 = 62 = Menge von Position3 (hinzugefügter Pos mit Formeln) geteilt durch 10 → Ergebnis auf 2 Stellen gerundet = 93

## Rechnen mit einer oder mehreren Variablen

Grundsätzlich ist es in Xentralmöglich einzelne Felder aus dem Artikelstamm anzusprechen.Die Syntax dafür ist: {{ARTIKEL:&lt;FELDNAME&gt;}} Ein Feldname kann beispielsweise eine Position im Artikelstamm sein. Hier könnten Sie die Höhe des Artikels verwenden. Die dazugehörige Formel sieht dann so aus {{ARTIKEL:HOEHE}}:

![formeln_12.png](https://help.xentral.com/hc/article_attachments/5078124840988)

Ein möglicher Anwendungsfall wäre die Berechnung des Verkaufspreises aufgrund der Fläche eines Artikels. Damit kann man die verschiedenen Felder gemäß der Rechenregeln verarbeiten. In unserem Beispiel muss folgende Formel verwendet werden: {{ARTIKEL:LAENGE*ARTIKEL:BREITE/100}}

Diese kann man direkt im Artikelstamm hinterlegen und damit sofort den Preis im Beleg berechnen lassen (Artikel >Details)

![formeln_13.png](https://help.xentral.com/hc/article_attachments/5078145111068)

Und erzeugt folgendes Ergebnis:

![formeln_14.png](https://help.xentral.com/hc/article_attachments/5078139237276)

## Sonderfunktionen

In dieser Rubrik möchten wir Ihnen weitere Möglichkeiten vorstellen, wie Sie mit Formeln arbeiten können. Wenn Ihnen der Umgang mit Spaltenoperationen bekannt ist, wie z.B. aus Excel, haben Sie ausreichende Vorkenntnisse um die Sonderfunktionen zu nutzen. Zu Beginn zeigen wir Ihnen die grundlegenden Formatierungsmöglichkeiten, mit denen Sie das Ergebnis anpassen können. Zum Beispiel können Sie das Ergebnis einer Rechenoperation so ausgeben lassen, dass nur zwei Nachkommastellenangezeigt werden.

Die Zahlen sind exemplarisch aufgeführt und können sinngemäß verändert werden:

- {{format(Zahl,4)}}: zeigt immer 4 Nachkommastellen an
- {{round(Zahl,2)}}: rundet auf 2 Nachkommastellen
- {{abs(Zahl)}}: schneidet alle Nachkommastellen ab ohne zu runden

Für spezielle Anwendungen stellen wir diese mathematischen Operationen zur Verfügung:

- {{sin(Bogenmaß)}}: gibt den Sinuswert des eingegeben Bogenmaß zurück
- {{cos(Bogenmaß)}}: gibt den Cosinuswert des eingegeben Bogenmaß zurück
- {{sqrt(Zahl)}}: zieht die Quadratwurzel
- {{wurzel(Radikant, Wurzelexponent}}: zieht die Wurzel mit beliebigem Radikant und Wurzelexponent

InXentralkönnen Sie erweiterte Spaltenoperationen durchführen. Die Position, in der Formel POS: erwartet als Bezug ein Feld mit dem Sie operieren möchten. Im unteren Beispiel haben wir die Position Preis verwendet. Analog verhält es sich zur Position Menge. Folgende Regeln helfen Ihnen alle Möglichkeiten effizient auszuschöpfen:

- die Schreibweise POS: enthält keine Einschränkungen bezüglich der Position. Alle Positionen werden durchlaufen
- die Schreibweise POS1: bezieht sich nur auf die Position 1
- {{spaltensumme(POS:preis *POS:menge)}}: Liefert die Summe aus (POS1:preis * POS1:menge) + (POS2:preis*POS2:menge) + (POS3:preis* POS3:menge) etc. Diese Formel läuft über jedes Element in einem Beleg. Mit diesem Beispiel wäre die Summe das "Gesamt Netto"
- {{spaltensummebis(POS:preis * POS:menge)}}: Verhält sich wie obige Formel aber liefert die Summe der Spaltenpositionen bis zur eigenen Zeile. Es werden also nicht alle Positionen durchlaufen, sondern nur bis zur eigenen Position (exklusive)
- {{zwischensumme(POS:preis * POS:menge)}}: Liefert die Summe aller Positionen zwischen zwei Spezialfeldern

Als Spezialfelder können Sie folgende Auswahl vornehmen:

![formeln_15.png](https://help.xentral.com/hc/article_attachments/5078177335068)

Beispiel: In Freifeld 1 haben Sie die jeweilige Eingangsspannung eines Servers hinterlegt. Um die Gesamtspannung in der Gruppe auszuwerten, können Sie die Freifelder 1 über alle Positionen addieren. Da Sie Sich aber nur für die Gruppe Sonderausstattung interessieren, benutzen Sie bitte die Formel "zwischensumme(POS:freifeld1)".Tragen Sie wie auf dem Bild die Formel in die Position des Beleges ein.

![formeln_17.png](https://help.xentral.com/hc/article_attachments/5078145213596)

Das Ergebnis sieht auf dem Beleg wie folgt aus:

![formeln_18.png](https://help.xentral.com/hc/article_attachments/5078155772700)

## Verfügbare Variablen

Die folgenden Variablen sind im Formelmodul verfügbar*.

Bitte ersetzen Sie jeweils das X durch eine Zahl (bei Referenzierung einer bestimmten Zeile) oder lassen es weg (bei Anwendung der Formel auf die aktuelle Zeile. Alternativ verwenden Sie statt "posX" das Wort "artikel" wenn Sie direkt auf die Artikelstammdaten zugreifen wollen ohne positionsspezifische Modifikationen zu berücksichtigen.

- posX:id
- posX:auftrag
- posX:artikel
- posX:projekt
- posX:bezeichnung
- posX:beschreibung
- posX:internerkommentar
- posX:nummer
- posX:menge
- posX:preis
- posX:waehrung
- posX:lieferdatum
- posX:vpe
- posX:sort
- posX:status
- posX:umsatzsteuer
- posX:bemerkung
- posX:geliefert
- posX:geliefert_menge
- posX:explodiert
- posX:explodiert_parent
- posX:logdatei
- posX:punkte
- posX:bonuspunkte
- posX:mlmdirektpraemie
- posX:keinrabatterlaubt
- posX:grundrabatt
- posX:rabattsync
- posX:rabatt1... posX:rabatt5
- posX:einheit
- posX:webid
- posX:rabatt
- posX:nachbestelltexternereinkauf
- posX:zolltarifnummer
- posX:herkunftsland
- posX:artikelnummerkunde
- posX:freifeld1... posX:freifeld40
- posX:lieferdatumkw
- posX:teilprojekt
- posX:steuersatz
- posX:steuertext
- posX:erloese
- posX:erloesefestschreiben
- posX:einkaufspreiswaehrung
- posX:einkaufspreis
- posX:einkaufspreisurspruenglich
- posX:einkaufspreisid
- posX:ekwaehrung
- posX:deckungsbeitrag
- posX:formelmenge
- posX:formelpreis
- posX:ohnepreis
- posX:potentiellerliefertermin
- posX:skontobetrag
- posX:steuerbetrag
- posX:skontosperre
- posX:ausblenden_im_pdf
- posX:kostenstelle
- posX:umsatz_netto_einzeln
- posX:umsatz_netto_gesamt
- posX:umsatz_brutto_einzeln
- posX:umsatz_brutto_gesamt
- posX:zolleinzelwert
- posX:zollgesamtwert
- posX:zollwaehrung
- posX:zolleinzelgewicht
- posX:zollgesamtgewicht

Sollte einer der Werte durch das Formelmodul nicht gefüllt werden, kann das an der Belegart liegen - nicht alle Werte sind in allen Belegen verfügbar.

## Anwendungsbeispiele

### Formel für die Umrechnung der Stückzahl aus Großpackung für die Produktionsanweisung

Ich habe eine Produktions-Stückliste in der verschiedene Artikel hinterlegt sind, u.a. ein Artikel den es nur als Großpackung (Stifte) im 12er Pck gibt. Für den Produktionsartikel werden nur 8 Stück aus der Großpackung benötigt, wie kann die Stückliste angelegt werden, damit der Mitarbeiter aus dem Lager weiß, dass er 8 Stück entnehmen muss. Würde "8" in die Stückliste eingetragen werden, wären es 8 x 12er Packs statt 8 einzelne Stifte. In der Stückliste selbst müsste für den entsprechende Anteil von einem Pack für das Beispiel 0,666 Stück der Großpackung eingetragen werden. Damit der Lagermitarbeiter sich die tatsächliche Stückzahl nicht ausrechnen muss, kann diese Information mit einer Formel in einem Freifeld zusätzlich im Produktionszettel ausgegeben werden.

Hierzu zunächst zwei Artikel Freifelder anlegen, einen für die VPE-Menge des Artikel und einen für die Formel welcher auf dem Produktionszettel ausgegeben werden soll. In dem Großpackungsartikel muss in das eine Feld die untenstehende Formel eingetragen werden und in das andere Freifeld die VPE Menge, welche zur Berechnung in die Formel einfließt.

Freifelder anlegen (Administration >Einstellungen >System >Grundeinstellungen >Freifelder):

![formeln_19.png](https://help.xentral.com/hc/article_attachments/5078125036956)

Formel anlegen: Folgende Formel kann dafür verwendet werden. Formel mit Rundung auf eine ganze Zahl: round(pos:menge*artikel:freifeld1,0)

Freifeld Nummer entsprechend durch die Nummer des Freifelds ersetzen

Artikel Freifelder befüllen:

![formeln_20.png](https://help.xentral.com/hc/article_attachments/5078139408668)

Ansicht der Produktionsanweisung mit entsprechender Stückzahl (aufgerundet):

![formeln_21.png](https://help.xentral.com/hc/article_attachments/5078139431964)